#!/usr/bin/env bash
set -e

sleep 2
for i in $(seq 1 3); do
  dance-yell "$i"
  sleep 0.4
  dance-yell "un"
  sleep 0.2
done
dance-yell "gatavs!"

# Hmm, might be needed on boot.
dance-scan-once & pid=$!
sleep 2
kill "$pid"

while true; do
  id=$(dance-scan-once)
  if jq '.[] | select(.Admin == "x")' < /var/dance/students.json | grep >/dev/null "$id"; then
    dance-admin-menu || true
  else
    if grep >/dev/null "$id" /var/dance/today/registered-students; then
      dance-yell "Šodien jau reģistrējies!"
    else
      dance-welcome-student "$id"
    fi
  fi
  sleep 3
done
