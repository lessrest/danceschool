#!/usr/bin/env bash
set -e

dance-yell "Activating scanner..."
sleep 5
dance-yell "Scanner activated."

while true; do
  id=$(dance-scan-once)
  if jq '.[] | select(.Admin == "x")' < /var/dance/students.json | grep >/dev/null "$id"; then
    dance-admin-menu
  else
    if grep >/dev/null "$id" /var/dance/today/registered-students; then
      dance-yell "Šodien jau reģistrējies!"
    else
      dance-welcome-student "$id"
    fi
  fi
  sleep 3
done
