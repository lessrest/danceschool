#!/usr/bin/env bash
set -e

sleep 6
for i in $(seq 1 4); do
  dance-yell "$1"
  sleep 0.5
  dance-yell "un"
  sleep 0.5
done
dance-yell "Gatavs!"

while true; do
  id=$(dance-scan-once)
  if jq '.[] | select(.Admin == "x")' < /var/dance/students.json | grep >/dev/null "$id"; then
    dance-admin-menu || true
  else
    if grep >/dev/null "$id" /var/dance/today/registered-students; then
      dance-yell "Šodien jau reģistrējies!"
    else
      dance-welcome-student "$id"
    fi
  fi
  sleep 3
done
